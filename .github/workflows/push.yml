name: Push workflow

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - name: Dump GitHub context
      env:
        GITHUB_CONTEXT_COMMIT_MSG: ${{ toJson(github.event.commits) }}
        GITHUB_CONTEXT_COMMIT_MSG_COND: ${{ contains(stringify(github.event.commits), '[skip ci]') }}
        GITHUB_CONTEXT: ${{ toJson(github) }}
      run: |
        echo "$GITHUB_CONTEXT_COMMIT_MSG"
        echo "$GITHUB_CONTEXT_COMMIT_MSG_COND"
        echo "$GITHUB_CONTEXT"
    - name: Docker build
      if:
        github.event.deleted == false &&
        github.event_name != 'create' &&
        contains(stringify(github.event.commits), '[skip ci]') == false
      run: docker build -t peaceiris/actions-hugo .
    - name: Check Hugo version
      if:
        success() &&
        contains(stringify(github.event.commits), '[skip ci]') == false
      run: docker run peaceiris/actions-hugo:latest version
